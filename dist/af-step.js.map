{"version":3,"file":"af-step.js","sources":["../src/af-step.ts"],"sourcesContent":["import type ActionForm from \"./action-form\";\nimport { makeAttributes } from \"./helpers\";\n\nexport default class ActionFormStep extends HTMLElement {\n\tprivate shadow: ShadowRoot | null;\n\n\t// Attributes set up with get/set using makeAttributes\n\tpublic valid!: boolean;\n\tpublic completed!: boolean;\n\tpublic active!: boolean;\n\tpublic index!: number;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tmakeAttributes(this, [\n\t\t\t{ attr: \"completed\", type: \"boolean\" },\n\t\t\t{ attr: \"active\", type: \"boolean\" },\n\t\t\t{ attr: \"valid\", type: \"boolean\" },\n\t\t\t{ attr: \"index\", type: \"number\" },\n\t\t]);\n\n\t\tconst internals = this.attachInternals();\n\t\tthis.shadow = internals.shadowRoot;\n\t\tthis.this = this.shadow || this;\n\n\t\t// update validity when input event is fired\n\t\tthis.this.addEventListener(\"input\", () => {\n\t\t\t// console.log(this.isValid);\n\t\t\tthis.valid = this.isValid;\n\t\t\tthis.completed = this.completed && this.valid;\n\t\t});\n\t\t// change validity when count event is fired from af-group-count\n\t\tthis.this.addEventListener(\"count\", (event) => {\n\t\t\tconst customEvent = event as CustomEvent<{ validity: boolean; value: number }>;\n\t\t\tthis.valid = customEvent.detail.validity;\n\t\t});\n\n\t\t// trigger next or prev step\n\t\tthis.this.addEventListener(\"click\", (e) => {\n\t\t\tconst target = e.target;\n\t\t\tif (!(target instanceof HTMLButtonElement)) return;\n\t\t\tconsole.log(\"ðŸš€ ~ FormStep ~ this.addEventListener ~ target:\", target);\n\n\t\t\tif (target.matches(\".af-step-next\")) {\n\t\t\t\tthis.step(\"next\");\n\t\t\t} else if (target.matches(\".af-step-prev\")) {\n\t\t\t\tthis.step(\"prev\");\n\t\t\t}\n\t\t});\n\t}\n\n\t// this.this works if component uses Declarative Shadow DOM or not\n\t// TODO: test this with a browser that does not have Declarative Shadow DOM\n\tprivate this: this | ShadowRoot;\n\n\tprivate actionForm = this.closest(\"action-form\") as ActionForm | null;\n\tprivate numberOfSteps = this.actionForm?.steps?.length || 0;\n\n\tget isValid(): boolean {\n\t\treturn this.querySelectorAll(\":invalid\").length === 0;\n\t}\n\n\tget nextStep(): number | null {\n\t\treturn this.index + 1 < this.numberOfSteps ? this.index + 1 : null;\n\t}\n\tget prevStep(): number | null {\n\t\treturn this.index - 1 >= 0 ? this.index - 1 : null;\n\t}\n\n\tget isLastStep(): boolean {\n\t\treturn this.index === this.numberOfSteps - 1;\n\t}\n\n\tpublic step(direction: \"prev\" | \"next\" = \"next\") {\n\t\tconst directionIndex = direction === \"next\" ? this.nextStep : this.prevStep;\n\t\t// guard against negative step\n\t\tif (directionIndex === null) return;\n\n\t\tconsole.log(\"ðŸš€ ~ FormStep ~ step ~ directionIndex:\", directionIndex);\n\n\t\t// If button is next check if any elements are invalid before moving to next step\n\t\tif (direction === \"next\" && this.querySelectorAll(\":invalid\").length > 0) {\n\t\t\tconst invalidElements = this.querySelectorAll(\":invalid\");\n\n\t\t\t// If any are invalid then focus on first invalid\n\t\t\tArray.from(invalidElements).some((element) => {\n\t\t\t\tif (element instanceof HTMLInputElement || element instanceof HTMLSelectElement || element instanceof HTMLTextAreaElement) {\n\t\t\t\t\tconsole.log(\"af-step: invalid element\", element);\n\n\t\t\t\t\telement.focus();\n\t\t\t\t\telement.dispatchEvent(new CustomEvent(\"toggle-error\"));\n\n\t\t\t\t\t// return true on first matching element. This ends the loop\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// console.log(\"invalid unknown element\", element);\n\t\t\t\t// ignore non matching elements\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t// Search also for fieldset elements that are invalid\n\t\t\tArray.from(invalidElements).some((element) => {\n\t\t\t\tif (element instanceof HTMLFieldSetElement) {\n\t\t\t\t\tconsole.log(\"af-step: invalid element\", element);\n\t\t\t\t\telement.dispatchEvent(new CustomEvent(\"toggle-error\"));\n\t\t\t\t\tconst firstField = element.querySelector(\"input, select, textarea\") as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement;\n\t\t\t\t\tif (firstField) {\n\t\t\t\t\t\tfirstField.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t// this return stops the step event from advancing\n\t\t\treturn;\n\t\t}\n\t\tif (direction === \"next\") {\n\t\t\tthis.completed = true;\n\t\t}\n\n\t\tthis.active = false;\n\t\tthis.dispatchEvent(new CustomEvent(\"af-step\", { bubbles: true, detail: { step: directionIndex } }));\n\t}\n\n\tpublic connectedCallback(): void {\n\t\t// console.log(\"connected\");\n\t\tthis.valid = this.isValid;\n\t\tthis.completed = false;\n\n\t\t// check for footer\n\t\tconst footer = this.this.querySelector(\"slot[name=footer]\") || this.this.querySelector(\"[slot=footer]\");\n\n\t\t// add footer if it doesn't exist\n\t\tif (!footer) {\n\t\t\tconst nav = document.createElement(\"nav\");\n\t\t\tnav.classList.add(\"af-step-nav\");\n\t\t\tnav.setAttribute(\"part\", \"step-nav\");\n\t\t\tnav.setAttribute(\"aria-label\", \"Step Navigation\");\n\t\t\tconst stepButton = (direction: \"Next\" | \"Prev\") => {\n\t\t\t\treturn `<button type=\"button\" class=\"af-step-${direction.toLowerCase()}\" part=\"step-btn\">${direction}</button>`;\n\t\t\t};\n\t\t\tconst blank = `<span></span>`;\n\t\t\tnav.innerHTML = `${this.prevStep !== null ? stepButton(\"Prev\") : blank}\n            ${this.nextStep !== null ? stepButton(\"Next\") : blank}`;\n\t\t\tthis.this.appendChild(nav);\n\t\t}\n\t}\n}\n\ncustomElements.define(\"af-step\", ActionFormStep);\n"],"names":["ActionFormStep","__publicField","_b","_a","makeAttributes","internals","event","customEvent","target","direction","directionIndex","invalidElements","element","firstField","nav","stepButton","blank"],"mappings":"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"}