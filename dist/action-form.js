var M=Object.defineProperty;var T=(n,i,t)=>i in n?M(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var d=(n,i,t)=>(T(n,typeof i!="symbol"?i+"":i,t),t);const A=[];function E(n){const i=new Set;return[()=>{const s=A[A.length-1];return s&&i.add(s),n},s=>{n=s;for(const a of i)a.execute()}]}function b(n){const i={execute(){A.push(i),n(),A.pop()}};i.execute()}class $ extends HTMLElement{constructor(){super();d(this,"shadow");d(this,"DOM");d(this,"actionForm");const t=this.closest("action-form");if(t&&t.steps.all.length>0){this.actionForm=t;const e=this.attachInternals();this.shadow=e.shadowRoot,this.DOM=this.shadow||this,this.DOM.addEventListener("change",()=>{this.valid=this.isValid}),this.DOM.addEventListener("click",s=>{const a=s.target;a instanceof HTMLButtonElement&&(a.dataset.direction==="next"||a.dataset.direction==="prev")&&this.step(a.dataset.direction)}),b(()=>{console.log("ðŸ«¨ create effect: af-step: update button text"),t.steps.stepsLength(),this.setButtonTexts()})}}get valid(){return this.hasAttribute("valid")}set valid(t){t?this.setAttribute("valid",""):this.removeAttribute("valid")}get isValid(){return this.querySelectorAll(":invalid").length===0}getStepTitle(t){var s;let e=t==="next"?this.nextElementSibling:this.previousElementSibling;return e&&e instanceof HTMLElement&&e.style.display==="none"&&(e=t==="next"?e.nextElementSibling:e.previousElementSibling),e&&e.matches("af-step")?e.dataset.title||((s=this.actionForm)==null?void 0:s.dataset[t])||t.replace(/^\w/,a=>a.toUpperCase()):""}get submit(){var t;return((t=this.actionForm)==null?void 0:t.dataset.submit)||"Submit"}step(t="next"){var e;(e=this.actionForm)==null||e.steps[t]()}connectedCallback(){if(this.valid=this.isValid,!(this.DOM.querySelector("slot[name=footer]")||this.DOM.querySelector("[slot=footer]"))){const e=document.createElement("nav");e.classList.add("af-step-nav"),e.setAttribute("part","step-nav"),e.setAttribute("aria-label","Step Navigation");const s=(a="next")=>{const u=this.getStepTitle(a);return u?`<button type="button" class="af-step-${a}" data-direction="${a}" part="step-btn ${a}">${u}</button>`:a==="next"?`<button type="submit" part="submit">${this.submit}</button>`:"<span></span>"};e.innerHTML=`${s("prev")}${s("next")}`,this.DOM.appendChild(e)}}setButtonTexts(){this.DOM.querySelectorAll("button[data-direction]").forEach(e=>{(e.dataset.direction==="next"||e.dataset.direction==="prev")&&(e.textContent=this.getStepTitle(e.dataset.direction))})}}class q extends HTMLElement{constructor(){super();d(this,"shadow");d(this,"actionForm");this.shadow=this.attachShadow({mode:"open"});const t=this.closest("action-form");t&&t.steps.all.length>0&&(this.actionForm=t,this.shadow.addEventListener("click",e=>{const s=e.target;if(this.actionForm&&s instanceof HTMLButtonElement&&s.matches(".step")&&!s.disabled){const a=Number(s.dataset.index||0);t.steps.set(a)}}),b(()=>{const e=t.steps.stepsLength(),s=t.steps.stepIndex();console.log("ðŸ«¨ create effect: af-progress: rerender",e,s),this.render(e,s)}))}render(t,e){const s=e/(t-1)*100,a="<style>:host{display:grid;position:relative;align-items:center;--step-border-size:.22em;--step-bg:white;--step-text:inherit;--inactive:lightgray;--active:lightseagreen;--invalid:coral;--valid:var(--active);--valid-bg:var(--active);--valid-text:white}.progress{background:var(--active);height:.5em;grid-row:-1/1;grid-column:-1/1}nav{margin:0;padding:0;list-style:none;display:flex;justify-content:space-between;grid-row:-1/1;grid-column:-1/1}.bg{background:var(--inactive);height:.5em;grid-row:-1/1;grid-column:-1/1}.step{border:var(--step-border-size) solid var(--inactive);border-radius:100%;width:2em;height:2em;line-height:1.65em;text-align:center;background:var(--step-bg);font-size:.9em;position:relative;z-index:1;padding:0;margin:0;cursor:pointer;color:var(--step-text)}.valid:has(~ .active){border-color:var(--valid);background:var(--valid-bg);color:var(--valid-text)}.step:disabled{opacity:1;cursor:not-allowed}.active{border-color:var(--active)}.step:not(.valid):has(~ .active){border-color:var(--invalid)}</style>";this.shadow.innerHTML=`${a}
        <div class="bg" part="bg"></div>
        <div class="progress" part="progress" style="width: ${s}%;"></div>
        <nav part="nav">
        ${Array.from(this.actionForm.steps.getVisible()).map((u,h)=>{const r=h===e?"active":"",o=u.valid?"valid":"",c=this.hasAttribute("enable-all")||e>h?"":"disabled",l=u.dataset.title||"";return`<button type="button" part="step ${o} ${r}" ${c} title="${l}" class="step ${o} ${r}" ${r&&'aria-current="step"'} aria-label="Step ${h+1}" data-index="${h}">${h+1}</button>`}).join("")}
        </nav>
        `}}function x(n=""){return`${n?n+"-":""}${Math.random().toString(36).substring(2,9)}`}function y(n){return!!n&&(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n instanceof HTMLSelectElement)}function L(n){return!!n&&(y(n)||n instanceof F)}class I extends HTMLElement{constructor(){super();d(this,"target",null);d(this,"shadow",this.attachShadow({mode:"open"}))}addAria(t){if(L(t)){const e=t.getAttribute("aria-describedby")||this.getAttribute("id")||x(t.id);this.setAttribute("id",e),t.setAttribute("aria-describedby",e)}}connectedCallback(){var s;this.style.visibility="hidden";const t=this.getAttribute("for")||"",e=t?document.getElementById(t):(s=this.closest("label"))==null?void 0:s.querySelector("input, select, textarea");L(e)&&(this.addAria(e),this.render())}static get observedAttributes(){return["data-invalid"]}attributeChangedCallback(t,e,s){t==="data-invalid"&&(s==="pattern"||s==="required")&&this.render(s)}render(t="required"){const e={required:"<slot>Required</slot>",pattern:'<slot name="pattern">Not filled in properly</slot>'};this.shadow.innerHTML=e[t]}}class w extends HTMLElement{constructor(){super();d(this,"shadow",this.attachShadow({mode:"open"}));d(this,"internals",this.attachInternals());d(this,"name",this.getAttribute("name")||"");this.render(),this.checkValidity(),this.addEventListener("change",t=>{t.target!==this&&(this.checkValidity(),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})))})}get min(){return Number(this.getAttribute("min")||0)}get max(){return Number(this.getAttribute("max")||1/0)}get value(){let t=[];const e=this.querySelectorAll("input, select, textarea");return t=Array.from(e).filter(s=>s instanceof HTMLInputElement&&["checkbox","radio"].includes(s.type)?s.checked:s.checkValidity()&&s.value),t.length}set value(t){this.setAttribute("value",String(t))}focus(){const t=this.querySelector("input, select, textarea");t&&t.focus()}checkValidity(){const t=this.value>=this.min&&this.value<=this.max;return this.setValidity(t),t}setValidity(t){const e=t?{}:{customError:!0},s=t?"":"Value is out of range";this.internals.setValidity(e,s),this.setAttribute("validity",String(t))}render(){this.shadow.innerHTML="<slot></slot>"}}d(w,"formAssociated",!0);class H extends HTMLElement{constructor(){var t;super();d(this,"afFieldGroup",this.closest("af-field-group"));this.render(),(t=this.afFieldGroup)==null||t.addEventListener("change",()=>this.render())}get value(){return this.afFieldGroup?this.afFieldGroup.value:0}render(){this.innerHTML=`${this.value.toString()}`}}function V(n){return n.replace(/[-_](.)/g,function(i){return" "+i.charAt(1).toUpperCase()}).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,function(i){return i.toUpperCase()})}class k extends HTMLElement{constructor(){super(...arguments);d(this,"actionForm")}connectedCallback(){const t=this.closest("action-form");if(t&&t instanceof F){if(this.actionForm=t,!t.querySelector("form"))return;b(()=>{this.render(this.actionForm.data.getForm())})}}get ignore(){var t;return((t=this.getAttribute("ignore"))==null?void 0:t.split(","))||[]}render(t){const e=s=>s.map(a=>typeof a=="string"?a:"FILE").toString();t&&!Array.isArray(t)&&(this.innerHTML=`<ul>${Object.entries(t).filter(([s])=>!this.ignore.includes(s)).map(([s,a])=>`<li><strong>${this.hasAttribute("title-case")?V(s):s}</strong>: ${e(a)}</li>`).join("")}</ul>`)}}class C extends HTMLElement{getNumber(i){const t=Number(i.getAttribute("maxlength")||1/0);this.textContent=String(this.hasAttribute("remaining")?t-i.value.length:i.value.length)}connectedCallback(){var e;const i=this.getAttribute("for"),t=i?document.getElementById(i):(e=this.closest("label"))==null?void 0:e.querySelector("input, textarea");(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&(this.getNumber(t),t.addEventListener("input",()=>this.getNumber(t)))}}function O(n){const i=new Map,[t,e]=E(r());function s(){e(r())}function a(o){const c=h(o);if(i.has(o))i.get(o).set(c);else{const[l,m]=E(c);i.set(o,{get:l,set:m})}}function u(o){var c;return(c=i.get(o))==null?void 0:c.get()}function h(o){return new FormData(n).getAll(o)}function r(){const o=new FormData(n).keys(),c={};return Array.from(o).forEach(l=>{c[l]=h(l)}),c}return{set:a,get:u,getForm:t,setForm:s,formDataObject:r}}function B(n){const[i,t]=E(0),[e,s]=E(h()[0]),[a,u]=E(h().length);function h(){return Array.from(n).filter(f=>f.style.display!=="none")}function r(){u(h().length)}function o(f=0){t(f),s(h()[f])}function c(f=0){const v=i(),g=Math.max(0,Math.min(v+f,h().length-1));g!==v&&o(g)}function l(){c(-1)}function m(){const f=e().querySelector(":invalid:not(fieldset)");f instanceof HTMLElement?(f.focus(),f.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))):c(1)}return{all:n,getVisible:h,currentStep:e,stepIndex:i,stepsLength:a,updateSteps:r,set:o,move:c,prev:l,next:m}}class F extends HTMLElement{constructor(){super();d(this,"form",this.querySelector("form")||null);d(this,"storeKey",this.hasAttribute("store")?this.getAttribute("store")||`action-form-${this.id||this.form.id||x()}`:"");d(this,"persistedFields",[]);d(this,"data",O(this.form));d(this,"steps",B(this.querySelectorAll("af-step")));const t=this.form;if(t){this.hasAttribute("novalidate")&&t.setAttribute("novalidate",""),this.persistedFields=Array.from(this.querySelectorAll("[data-persist]")).filter(r=>y(r)),this.storeKey&&this.restoreFieldValues(),window.addEventListener("storage",r=>{this.log("storage",r,r.key),this.hasAttribute("store-listen")&&r.key===this.storeKey&&this.restoreFieldValues()}),b(()=>{this.log("ðŸ«¨ create effect ~ action-form: step activation");const r=this.steps.currentStep();this.steps.all.forEach(o=>{o===r?o.classList.add("active"):o.classList.remove("active")})});const e=Array.from(this.querySelectorAll("af-field-group")),s=Array.from(this.querySelectorAll("[required],[pattern],[type=phone],[type=email],[type=url],[minlength],[maxlength]"));[...e,...s].forEach(r=>{r.id||(r.id=x(`${r.tagName.toLowerCase()}${r.name?`-${r.name}`:""}`))}),this.hasAttribute("auto-error")&&(s.forEach(r=>{var l;if(r.hasAttribute("aria-describedby"))return;const o=t.querySelector(`af-error[for="${r.id}"]`),c=(l=r.closest("label"))==null?void 0:l.querySelector("af-error");!o&&!c&&(r.after(this.createAfError(r)),this.log(`Added Error Message for ${r.id}`))}),e.forEach(r=>{if(r.hasAttribute("aria-describedby"))return;r.querySelector(`af-error[for="${r.id}"]`)||(r.append(this.createAfError(r)),this.log(`Added Error Message for ${r.id}`))})),new Set(Array.from(t.elements).map(r=>r.name||"").filter(r=>r)).forEach(r=>{this.data.set(r)}),t.addEventListener("change",r=>{const o=r.target;o instanceof HTMLElement&&(o.name&&(this.data.set(o.name),this.data.setForm()),this.storeKey&&localStorage.setItem(this.storeKey,JSON.stringify(this.data.formDataObject())))}),[...s,...e].forEach(r=>{b(()=>{this.log("ðŸ«¨ create effect ~ action-form: error checking"),this.data.get(r.name),this.toggleError(r)})}),this.querySelectorAll("[data-if],[data-text]").forEach(r=>{if(r instanceof HTMLElement){const o=r.dataset.if,c=r.dataset.text;b(()=>{if(this.log("ðŸ«¨ create effect: action-form: enhance elements"),o){const l=this.data.get(o);if(l){const m=r.dataset.ifValue,f=r.dataset.ifNotValue,v=r.dataset.ifRegex,g=v?new RegExp(v):void 0;if(m||f||g){const S=l.some(p=>typeof p=="string"&&(m&&p===m||g&&g.test(p)))&&l.every(p=>typeof p=="string"&&(!f||p!==f));this.show(r,S)}else this.show(r,!!l.some(S=>!!S))}}if(c){const l=this.data.get(c);l&&(r.textContent=l==null?void 0:l.toString())}})}}),this.querySelectorAll("button[type=reset]").forEach(r=>{r.addEventListener("click",o=>{o.preventDefault(),this.persistedFields.forEach(c=>y(c)?c.dataset.persist=c.value:null),this.form.reset(),this.persistedFields.forEach(c=>y(c)&&typeof c.dataset.persist=="string"?c.value=c.dataset.persist:null),this.restoreForm()})}),this.addEventListener("submit",r=>{if(t.checkValidity())this.restoreForm();else{r.preventDefault();const c=this.form.querySelector(":invalid:not(fieldset)");if(c&&c instanceof HTMLElement){const l=c.closest("af-step"),m=this.steps.getVisible().findIndex(f=>f===l);if(m!==-1)this.steps.set(m),this.steps.next();else throw new Error(`Invalid field: ${c.id}`)}}})}}createAfError(t){const e=document.createElement("af-error");if(e.setAttribute("for",t.id),e.textContent=t.dataset.error||"",t.dataset.errorPattern){const s=document.createElement("span");s.setAttribute("slot","pattern"),s.textContent=t.dataset.errorPattern,e.append(s)}return e}toggleError(t){const e=document.getElementById(t.getAttribute("aria-describedby")||"");if(e&&typeof t.checkValidity=="function"){const s=t.checkValidity();this.log("errorMsg.id, valid",e.id,s),s?this.resetError(t,e):(e.style.visibility="visible",t.setAttribute("aria-invalid","true"),e.dataset.invalid=t.value===""?"required":"pattern")}}resetError(t,e){t.removeAttribute("aria-invalid"),e.style.visibility="hidden",e.removeAttribute("data-invalid")}restoreForm(){this.resetStore(),this.querySelectorAll("[aria-invalid]").forEach(e=>{if(L(e)){const s=document.getElementById(e.getAttribute("aria-describedby")||"");s&&this.resetError(e,s)}})}resetStore(){const t=localStorage.getItem(this.storeKey);if(t&&this.persistedFields.length>0){const e=JSON.parse(t);Object.keys(e).forEach(s=>{this.persistedFields.every(a=>a.name!==s)&&delete e[s]}),localStorage.setItem(this.storeKey,JSON.stringify(e))}else localStorage.removeItem(this.storeKey)}restoreFieldValues(){const t=localStorage.getItem(this.storeKey);if(!t||t==="undefined")return;const e=JSON.parse(t);typeof e=="object"&&Object.keys(e).forEach(s=>{this.querySelectorAll(`[name="${s}"]`).forEach(u=>{y(u)&&!u.matches("[type=hidden]")&&(u instanceof HTMLInputElement&&["checkbox","radio"].includes(u.type)&&e[s]instanceof Array?u.checked=e[s].includes(u.value):u.value=String(e[s]))})})}show(t,e){e?(t.style.display="",t.removeAttribute("disabled")):(t.style.display="none",t.setAttribute("disabled","")),t.dispatchEvent(new Event("change",{bubbles:!0})),t.matches("af-step")&&this.steps.updateSteps(),t.matches("fieldset")&&t.querySelectorAll("input, select, textarea").forEach(a=>{this.data.set(a.name)})}log(...t){this.hasAttribute("debug")&&console.log(...t)}}customElements.define("action-form",F);customElements.define("af-error",I);customElements.define("af-step",$);customElements.define("af-progress",q);customElements.define("af-field-group",w);customElements.define("af-field-group-count",H);customElements.define("af-text-count",C);customElements.define("af-preview",k);
//# sourceMappingURL=action-form.js.map
