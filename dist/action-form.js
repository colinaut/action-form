var m=Object.defineProperty;var p=(l,d,a)=>d in l?m(l,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[d]=a;var u=(l,d,a)=>(p(l,typeof d!="symbol"?d+"":d,a),a);function h(l){return l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l instanceof HTMLSelectElement}class g extends HTMLElement{constructor(){super();u(this,"steps",this.querySelectorAll("af-step"));u(this,"stepIndex",0);u(this,"watchers",[]);document.documentElement.classList.add("js");const a=this.querySelector("form");a&&(this.hasAttribute("novalidate")&&a.setAttribute("novalidate",""),this.steps.forEach((n,r)=>{n.dataset.index=String(r),r===0&&n.classList.add("first","active"),r===this.steps.length-1&&n.classList.add("last")}),this.addEventListener("af-step",n=>{var i,s,o,c;const r=n;let t=this.stepIndex;typeof((i=r.detail)==null?void 0:i.step)=="number"?t=r.detail.step:(s=r.detail)!=null&&s.direction&&(console.log("step",(o=r.detail)==null?void 0:o.direction),t=t+((c=r.detail)==null?void 0:c.direction)),t=Math.max(0,Math.min(t,this.steps.length-1)),this.stepIndex=t;let e=0;Array.from(this.steps).forEach(f=>{f.style.display!=="none"?(f.dataset.index=String(e),e++):f.dataset.index="",e-1===t?(f.classList.add("active"),this.stepIndex=t):f.classList.remove("active")})}),this.hasAttribute("auto-error")&&(this.querySelectorAll("[required],[pattern],[type=phone],[type=email],[type=url]").forEach(t=>{var o;let e=t.id||"";const i=a.querySelector(`af-error[for="${e}"]`),s=(o=t.closest("label"))==null?void 0:o.querySelector("af-error");if(!i&&!s){const c=document.createElement("af-error");c.textContent=t.dataset.error||"",e||(e=`${t.name||t.tagName.toLowerCase()}-${Math.random().toString(36).substring(2,9)}`,t.setAttribute("id",e)),c.setAttribute("for",e),t.after(c),console.log(`Added Error Message for ${t.tagName.toLowerCase()}[${t.name}] #${e}`)}}),this.querySelectorAll("fieldset[data-group]").forEach(t=>{let e=t.id||"";if(!t.querySelector(`af-error[for="${e}"]`)){e||(e=`${t.name||"fieldset"}-${Math.random().toString(36).substring(2,9)}`,t.setAttribute("id",e));const o=document.createElement("af-error");o.setAttribute("for",e),o.textContent=t.dataset.error||"",t.append(o)}if(!t.querySelector("af-group-count")){const o=document.createElement("af-group-count");o.style.display="none",t.append(o)}})),this.enhanceElements(),this.addEventListener("change",n=>{const r=n.target;if(r instanceof HTMLElement&&r.matches("input, textarea, select, af-group-count")){const t=r,e=t.getAttribute("aria-describedby");if(e){const s=document.getElementById(e);if(s!=null&&s.matches("af-error")){const o=s,c=t.checkValidity();o.showError(!c)}}const i=this.watchers.filter(s=>s.name===t.name);if(i.length>0&&this.checkWatchers(i),this.id&&this.hasAttribute("store")){const s=localStorage.getItem(`action-form-${this.id}`)||"{}";if(s&&t.name){const o=JSON.parse(s);if(t instanceof HTMLInputElement&&["checkbox","radio"].includes(t.type)){const c=o[t.name]instanceof Array?o[t.name]:[];t.checked?c.push(t.value):c.splice(c.indexOf(t.value),1),o[t.name]=c}else o[t.name]=t.value;localStorage.setItem(`action-form-${this.id}`,JSON.stringify(o))}}}}),this.addEventListener("reset",()=>{this.hasAttribute("store")&&localStorage.removeItem(`action-form-${this.id}`),a.querySelectorAll("af-error[invalid]").forEach(r=>{r.showError(!1)}),this.dispatchEvent(new CustomEvent("af-step",{detail:{step:0}}))}),this.addEventListener("submit",n=>{var t;if(a.checkValidity())this.hasAttribute("store")&&localStorage.removeItem(`action-form-${this.id}`);else{n.preventDefault(),console.error("Form validation failed");const e=a.querySelector("input:invalid, select:invalid, textarea:invalid, af-group-count[validity=false]");if(e){const i=e.closest("af-step");if(i&&this.dispatchEvent(new CustomEvent("af-step",{detail:{step:Number(i.dataset.index)}})),console.log("invalidField",e),e.matches("af-group-count")){const s=(t=e.closest("fieldset"))==null?void 0:t.querySelector("input, select, textarea");s==null||s.focus()}else e.focus();e.dispatchEvent(new Event("change",{bubbles:!0}))}}}))}enhanceElements(){if(this.querySelectorAll("[data-get-store]").forEach(r=>{const t=r.dataset.getStore;if(t&&h(r)){const e=t.split("."),i=localStorage.getItem(e[0]);if(i)if(e.length>1){const s=JSON.parse(i)[e[1]];s&&(r.value=String(s))}else r.value=i}}),this.id&&this.hasAttribute("store")){const r=localStorage.getItem(`action-form-${this.id}`);if(r){const t=JSON.parse(r);Object.keys(t).forEach(e=>{this.querySelectorAll(`[name="${e}"]`).forEach(s=>{h(s)&&!s.matches("[type=hidden]")&&(s instanceof HTMLInputElement&&["checkbox","radio"].includes(s.type)&&t[e]instanceof Array?s.checked=t[e].includes(s.value):s.value=String(t[e]))})})}}this.querySelectorAll("[data-if],[data-text]").forEach(r=>{const t=r.dataset.if||r.dataset.text,e=r.dataset.ifValue,i=r.dataset.ifNotValue,s=r.dataset.ifRegex,o=s?new RegExp(s):void 0;t&&this.watchers.push({name:t,if:!!r.dataset.if,text:!!r.dataset.text,value:e,notValue:i,regex:o,el:r})}),this.checkWatchers()}checkWatchers(a=this.watchers){const n=this.querySelector("form");if(!n||a.length===0)return;const r=new FormData(n);a.forEach(t=>{const e=r.getAll(t.name);if(t.text&&(t.el.textContent=e.join(", ")),t.if){let i=e.some(s=>typeof s=="string"&&(t.value||t.regex)?s===t.value||t.regex&&t.regex.test(s):!!s);t.notValue&&e.length!==0&&i&&(i=e.every(s=>s!==t.notValue)),this.show(t.el,i),t.el.matches("af-step")&&this.dispatchEvent(new CustomEvent("af-step"))}})}show(a,n){n?(a.style.display="",a.removeAttribute("disabled")):(a.style.display="none",a.setAttribute("disabled","")),a.dispatchEvent(new Event("change",{bubbles:!0}))}}customElements.define("action-form",g);
//# sourceMappingURL=action-form.js.map
