var m=Object.defineProperty;var p=(l,d,a)=>d in l?m(l,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[d]=a;var u=(l,d,a)=>(p(l,typeof d!="symbol"?d+"":d,a),a);function h(l){return l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l instanceof HTMLSelectElement}class g extends HTMLElement{constructor(){var f;super();u(this,"steps",this.querySelectorAll("af-step"));u(this,"stepIndex",0);u(this,"stepButtons");u(this,"watchers",[]);document.documentElement.classList.add("js");const a=this.querySelector("form");a&&(this.hasAttribute("novalidate")&&a.setAttribute("novalidate",""),this.steps.forEach((r,e)=>{r.setAttribute("index",String(e)),e===0&&r.classList.add("first","active"),e===this.steps.length-1&&r.classList.add("last")}),this.stepButtons=((f=this.getAttribute("step-buttons"))==null?void 0:f.split(","))||[],this.stepButtons.length!==3&&(this.stepButtons=["Prev","Next","Submit"]),this.addEventListener("af-step",r=>{var i,o,n;const e=r;let t=this.stepIndex;typeof((i=e.detail)==null?void 0:i.step)=="number"?t=e.detail.step:((o=e.detail)==null?void 0:o.direction)===this.stepButtons[1]?t++:((n=e.detail)==null?void 0:n.direction)===this.stepButtons[0]&&t--,t=Math.max(0,Math.min(t,this.steps.length-1)),this.stepIndex=t;let s=0;Array.from(this.steps).forEach(c=>{c.style.display!=="none"?(c.dataset.index=String(s),s++):c.dataset.index="",s-1===t?(c.classList.add("active"),this.stepIndex=t):c.classList.remove("active")})}),this.hasAttribute("auto-error")&&(this.querySelectorAll("[required],[pattern],[type=phone],[type=email],[type=url]").forEach(t=>{var n;let s=t.id||"";const i=a.querySelector(`af-error[for="${s}"]`),o=(n=t.closest("label"))==null?void 0:n.querySelector("af-error");if(!i&&!o){const c=document.createElement("af-error");c.textContent=t.dataset.error||"",s||(s=`${t.name||t.tagName.toLowerCase()}-${Math.random().toString(36).substring(2,9)}`,t.setAttribute("id",s)),c.setAttribute("for",s),t.after(c),console.log(`Added Error Message for ${t.tagName.toLowerCase()}[${t.name}] #${s}`)}}),this.querySelectorAll("fieldset[data-group]").forEach(t=>{let s=t.id||"";if(!t.querySelector(`af-error[for="${s}"]`)){s||(s=`${t.name||"fieldset"}-${Math.random().toString(36).substring(2,9)}`,t.setAttribute("id",s));const n=document.createElement("af-error");n.setAttribute("for",s),n.textContent=t.dataset.error||"",t.append(n)}if(!t.querySelector("af-group-count")){const n=document.createElement("af-group-count");n.style.display="none",t.append(n)}})),this.enhanceElements(),this.addEventListener("change",r=>{const e=r.target;if(e instanceof HTMLElement&&e.matches("input, textarea, select, af-group-count")){const t=e,s=t.getAttribute("aria-describedby");if(s){const o=document.getElementById(s);if(o!=null&&o.matches("af-error")){const n=o,c=t.checkValidity();n.showError(!c)}}const i=this.watchers.filter(o=>o.name===t.name);if(i.length>0&&this.checkWatchers(i),this.id&&this.hasAttribute("store")){const o=localStorage.getItem(`action-form-${this.id}`)||"{}";if(o&&t.name){const n=JSON.parse(o);if(t instanceof HTMLInputElement&&["checkbox","radio"].includes(t.type)){const c=n[t.name]instanceof Array?n[t.name]:[];t.checked?c.push(t.value):c.splice(c.indexOf(t.value),1),n[t.name]=c}else n[t.name]=t.value;localStorage.setItem(`action-form-${this.id}`,JSON.stringify(n))}}}}),this.addEventListener("reset",()=>{this.hasAttribute("store")&&localStorage.removeItem(`action-form-${this.id}`),a.querySelectorAll("af-error[invalid]").forEach(e=>{e.showError(!1)}),this.dispatchEvent(new CustomEvent("af-step",{detail:{step:0}}))}),this.addEventListener("submit",r=>{var t;if(a.checkValidity())this.hasAttribute("store")&&localStorage.removeItem(`action-form-${this.id}`);else{r.preventDefault(),console.error("Form validation failed");const s=a.querySelector("input:invalid, select:invalid, textarea:invalid, af-group-count[validity=false]");if(s){const i=s.closest("af-step");if(i&&this.dispatchEvent(new CustomEvent("af-step",{detail:{step:Number(i.dataset.index)}})),console.log("invalidField",s),s.matches("af-group-count")){const o=(t=s.closest("fieldset"))==null?void 0:t.querySelector("input, select, textarea");o==null||o.focus()}else s.focus();s.dispatchEvent(new Event("change",{bubbles:!0}))}}}))}enhanceElements(){if(this.querySelectorAll("[data-get-store]").forEach(r=>{const e=r.dataset.getStore;if(e&&h(r)){const t=e.split("."),s=localStorage.getItem(t[0]);if(s)if(t.length>1){const i=JSON.parse(s)[t[1]];i&&(r.value=String(i))}else r.value=s}}),this.id&&this.hasAttribute("store")){const r=localStorage.getItem(`action-form-${this.id}`);if(r){const e=JSON.parse(r);Object.keys(e).forEach(t=>{this.querySelectorAll(`[name="${t}"]`).forEach(i=>{h(i)&&!i.matches("[type=hidden]")&&(i instanceof HTMLInputElement&&["checkbox","radio"].includes(i.type)&&e[t]instanceof Array?i.checked=e[t].includes(i.value):i.value=String(e[t]))})})}}this.querySelectorAll("[data-if],[data-text]").forEach(r=>{const e=r.dataset.if||r.dataset.text,t=r.dataset.ifValue,s=r.dataset.ifNotValue,i=r.dataset.ifRegex,o=i?new RegExp(i):void 0;e&&this.watchers.push({name:e,if:!!r.dataset.if,text:!!r.dataset.text,value:t,notValue:s,regex:o,el:r})}),this.checkWatchers()}checkWatchers(a=this.watchers){const f=this.querySelector("form");if(!f||a.length===0)return;const r=new FormData(f);a.forEach(e=>{const t=r.getAll(e.name);if(e.text&&(e.el.textContent=t.join(", ")),e.if){let s=t.some(i=>typeof i=="string"&&(e.value||e.regex)?i===e.value||e.regex&&e.regex.test(i):!!i);e.notValue&&t.length!==0&&s&&(s=t.every(i=>i!==e.notValue)),this.show(e.el,s),e.el.matches("af-step")&&this.dispatchEvent(new CustomEvent("af-step"))}})}show(a,f){f?(a.style.display="",a.removeAttribute("disabled")):(a.style.display="none",a.setAttribute("disabled","")),a.dispatchEvent(new Event("change",{bubbles:!0}))}}customElements.define("action-form",g);
//# sourceMappingURL=action-form.js.map
