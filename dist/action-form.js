var f=Object.defineProperty;var m=(d,n,r)=>n in d?f(d,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[n]=r;var h=(d,n,r)=>(m(d,typeof n!="symbol"?n+"":n,r),r);class p extends HTMLElement{constructor(){super();h(this,"stepIndex",0);h(this,"watchers",[]);document.documentElement.classList.add("js");const r=this.querySelector("form");r&&(this.hasAttribute("novalidate")&&r.setAttribute("novalidate",""),this.steps.forEach((o,t)=>{o.setAttribute("index",String(t)),t===0&&o.classList.add("first","active"),t===this.steps.length-1&&o.classList.add("last")}),this.addEventListener("af-step",o=>{var a,s,i,c;const t=o;console.log("af-step",(a=t.detail)==null?void 0:a.step);let e=this.stepIndex;typeof((s=t.detail)==null?void 0:s.step)=="number"?e=t.detail.step:((i=t.detail)==null?void 0:i.direction)==="next"?e++:((c=t.detail)==null?void 0:c.direction)==="prev"&&e--,e=Math.max(0,Math.min(e,this.steps.length-1)),this.stepIndex=e,Array.from(this.steps).filter(l=>!l.hidden).forEach((l,u)=>{u===this.stepIndex?l.classList.add("active"):l.classList.remove("active")})}),this.hasAttribute("auto-error")&&this.querySelectorAll("[required],[pattern],[type=phone],[type=email],[type=url]").forEach(t=>{var i;let e=t.getAttribute("id")||"";const a=r.querySelector(`af-error[for="${e}"]`),s=(i=t.closest("label"))==null?void 0:i.querySelector("af-error");if(!a&&!s){const c=document.createElement("af-error");c.textContent=t.dataset.error||"",e||(e=`${t.id||t.name||t.tagName.toLowerCase()}-${Math.random().toString(36).substring(2,9)}`,t.setAttribute("id",e)),c.setAttribute("for",e),t.after(c),console.log(`Added Error Message for ${t.tagName.toLowerCase()}[${t.name}] #${e}`)}}),this.enhanceElements(),this.addEventListener("change",o=>{const t=o.target;if(t instanceof HTMLElement&&t.matches("input, textarea, select, af-group-count")){const e=t,a=e.getAttribute("aria-describedby");if(a){const s=document.getElementById(a);if(s!=null&&s.matches("af-error")){const i=s,c=e.checkValidity();i.showError(!c)}}}this.checkWatchers()}))}checkWatchers(){const r=this.querySelector("form");if(!r||this.watchers.length===0)return;const o=new FormData(r);this.watchers.forEach(t=>{const a=o.getAll(t.name).some(s=>typeof s=="string"&&(s===t.value||t.regex&&t.regex.test(s)));t.el.hasAttribute("hidden")===a&&(this.show(t.el,a),t.el.matches("af-step")&&this.dispatchEvent(new CustomEvent("af-step")))})}get steps(){return this.querySelectorAll("af-step")}enhanceElements(){this.querySelectorAll("input[data-stored]").forEach(t=>{const e=t.dataset.stored;if(e&&t instanceof HTMLInputElement){const a=e.split("."),s=localStorage.getItem(a[0]);if(s)if(a.length>1){const i=JSON.parse(s)[a[1]];i&&(t.value=i)}else t.value=s}}),this.querySelectorAll("[data-watch]").forEach(t=>{const e=t.dataset.watch,a=t.dataset.value,s=t.dataset.regex,i=s?new RegExp(s):!s&&!a?/./:void 0;e&&this.watchers.push({name:e,value:a,regex:i,el:t})}),this.checkWatchers()}show(r,o){o?(r.removeAttribute("hidden"),r.removeAttribute("disabled")):(r.setAttribute("hidden",""),r.setAttribute("disabled","")),r.dispatchEvent(new CustomEvent("af-watcher",{bubbles:!0,detail:{show:o}}))}}customElements.define("action-form",p);
//# sourceMappingURL=action-form.js.map
