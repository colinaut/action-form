{"version":3,"file":"action-form.js","sources":["../src/action-form.ts"],"sourcesContent":["import type ActionFormStep from \"./af-step\";\nimport type ActionFormError from \"./af-error\";\nimport type ActionFormGroupCount from \"./af-group-count\";\nimport type { ActionFormStepEvent } from \"./types\";\n\ntype FormField = HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n\nfunction isField(el: Element): el is FormField {\n\treturn el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement || el instanceof HTMLSelectElement;\n}\n\nexport default class ActionForm extends HTMLElement {\n\tpublic steps = this.querySelectorAll(\"af-step\") as NodeListOf<ActionFormStep>;\n\tpublic stepIndex: number = 0; // current step\n\tpublic stepButtons!: string[];\n\n\tprivate watchers: { el: HTMLElement; if: boolean; text: boolean; name: string; value?: string; notValue?: string; regex?: RegExp }[] = [];\n\n\tconstructor() {\n\t\tsuper();\n\t\tdocument.documentElement.classList.add(\"js\");\n\n\t\tconst form = this.querySelector(\"form\");\n\t\tif (form) {\n\t\t\t/*\n\t\t\t * Set novalidate on the form if novalidate set on action-form.\n\t\t\t * This way novalidate is only set if javascript is loaded and form-action is defined.\n\t\t\t * We want to allow falling back to browser validation if javascript is not loaded.\n\t\t\t */\n\t\t\tif (this.hasAttribute(\"novalidate\")) {\n\t\t\t\tform.setAttribute(\"novalidate\", \"\");\n\t\t\t}\n\n\t\t\tthis.steps.forEach((step, i) => {\n\t\t\t\tstep.setAttribute(\"index\", String(i)); // step.index = i;\n\t\t\t\tif (i === 0) {\n\t\t\t\t\tstep.classList.add(\"first\", \"active\");\n\t\t\t\t}\n\t\t\t\tif (i === this.steps.length - 1) {\n\t\t\t\t\tstep.classList.add(\"last\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Get step buttons\n\t\t\tthis.stepButtons = this.getAttribute(\"step-buttons\")?.split(\",\") || [];\n\t\t\tif (this.stepButtons.length !== 3) {\n\t\t\t\tthis.stepButtons = [\"Prev\", \"Next\", \"Submit\"];\n\t\t\t}\n\n\t\t\tthis.addEventListener(\"af-step\", (event) => {\n\t\t\t\tconst customEvent = event as CustomEvent<{ step?: number; direction?: string }>;\n\t\t\t\tlet stepIndex = this.stepIndex;\n\t\t\t\tif (typeof customEvent.detail?.step === \"number\") {\n\t\t\t\t\tstepIndex = customEvent.detail.step;\n\t\t\t\t} else if (customEvent.detail?.direction === this.stepButtons[1]) {\n\t\t\t\t\tstepIndex++;\n\t\t\t\t} else if (customEvent.detail?.direction === this.stepButtons[0]) {\n\t\t\t\t\tstepIndex--;\n\t\t\t\t}\n\t\t\t\t// make sure stepIndex is within bounds\n\t\t\t\tstepIndex = Math.max(0, Math.min(stepIndex, this.steps.length - 1));\n\t\t\t\t// set this.stepIndex\n\t\t\t\tthis.stepIndex = stepIndex;\n\t\t\t\t// set active based on index\n\t\t\t\tlet shownIndex = 0;\n\n\t\t\t\tArray.from(this.steps).forEach((step) => {\n\t\t\t\t\t// Set data-index Based on visibility of the step\n\t\t\t\t\tif (step.style.display !== \"none\") {\n\t\t\t\t\t\tstep.dataset.index = String(shownIndex);\n\t\t\t\t\t\tshownIndex++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep.dataset.index = \"\";\n\t\t\t\t\t}\n\t\t\t\t\t// set active based on index\n\n\t\t\t\t\tif (shownIndex - 1 === stepIndex) {\n\t\t\t\t\t\tstep.classList.add(\"active\");\n\t\t\t\t\t\tthis.stepIndex = stepIndex;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep.classList.remove(\"active\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Find all fields that require validation error messages\n\t\t\tif (this.hasAttribute(\"auto-error\")) {\n\t\t\t\tconst validationFields = this.querySelectorAll(\"[required],[pattern],[type=phone],[type=email],[type=url]\") as NodeListOf<FormField>;\n\t\t\t\tvalidationFields.forEach((field) => {\n\t\t\t\t\tlet id = field.id || \"\";\n\t\t\t\t\t// Check if there is an af-error attribute for the field, either by id or withing parent label\n\t\t\t\t\tconst errorById = form.querySelector(`af-error[for=\"${id}\"]`);\n\t\t\t\t\tconst errorByProximity = field.closest(\"label\")?.querySelector(`af-error`);\n\t\t\t\t\tif (!errorById && !errorByProximity) {\n\t\t\t\t\t\t// if not then make one\n\t\t\t\t\t\tconst error = document.createElement(\"af-error\");\n\t\t\t\t\t\t// Use data-error for content\n\t\t\t\t\t\terror.textContent = field.dataset.error || \"\";\n\t\t\t\t\t\t// If there is no id attribute on field then make one just to make things easier\n\t\t\t\t\t\tif (!id) {\n\t\t\t\t\t\t\tid = `${field.name || field.tagName.toLowerCase()}-${Math.random().toString(36).substring(2, 9)}`;\n\t\t\t\t\t\t\tfield.setAttribute(\"id\", id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\terror.setAttribute(\"for\", id);\n\t\t\t\t\t\t// add af-error after field\n\t\t\t\t\t\tfield.after(error);\n\t\t\t\t\t\tconsole.log(`Added Error Message for ${field.tagName.toLowerCase()}[${field.name}] #${id}`);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst fieldsetGroups = this.querySelectorAll(\"fieldset[data-group]\") as NodeListOf<HTMLFieldSetElement>;\n\n\t\t\t\tfieldsetGroups.forEach((fieldset) => {\n\t\t\t\t\tlet id = fieldset.id || \"\";\n\t\t\t\t\tconst errorById = fieldset.querySelector(`af-error[for=\"${id}\"]`);\n\t\t\t\t\tif (!errorById) {\n\t\t\t\t\t\tif (!id) {\n\t\t\t\t\t\t\tid = `${fieldset.name || \"fieldset\"}-${Math.random().toString(36).substring(2, 9)}`;\n\t\t\t\t\t\t\tfieldset.setAttribute(\"id\", id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst error = document.createElement(\"af-error\");\n\n\t\t\t\t\t\terror.setAttribute(\"for\", id);\n\t\t\t\t\t\terror.textContent = fieldset.dataset.error || \"\";\n\t\t\t\t\t\tfieldset.append(error);\n\t\t\t\t\t}\n\t\t\t\t\tconst groupCount = fieldset.querySelector(`af-group-count`) as ActionFormGroupCount | null;\n\t\t\t\t\tif (!groupCount) {\n\t\t\t\t\t\tconst groupCount = document.createElement(\"af-group-count\");\n\t\t\t\t\t\tgroupCount.style.display = \"none\";\n\t\t\t\t\t\tfieldset.append(groupCount);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.enhanceElements();\n\n\t\t\t/* -------------------------------------------------------------------------- */\n\t\t\t/*                                Add Listeners                               */\n\t\t\t/* -------------------------------------------------------------------------- */\n\n\t\t\tthis.addEventListener(\"change\", (event) => {\n\t\t\t\tconst target = event.target;\n\t\t\t\tif (target instanceof HTMLElement && target.matches(\"input, textarea, select, af-group-count\")) {\n\t\t\t\t\tconst field = target as FormField | ActionFormGroupCount;\n\n\t\t\t\t\t// if target has an error message, show/hide it\n\t\t\t\t\tconst errorId = field.getAttribute(\"aria-describedby\");\n\t\t\t\t\tif (errorId) {\n\t\t\t\t\t\tconst errorMsg = document.getElementById(errorId);\n\t\t\t\t\t\tif (errorMsg?.matches(\"af-error\")) {\n\t\t\t\t\t\t\tconst afError = errorMsg as ActionFormError;\n\t\t\t\t\t\t\tconst valid = field.checkValidity();\n\t\t\t\t\t\t\tafError.showError(!valid);\n\t\t\t\t\t\t\t// console.log(\"target\", target, errorId, valid);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// check if field has a name match in the watcher array\n\t\t\t\t\tconst watchers = this.watchers.filter((w) => w.name === field.name);\n\t\t\t\t\tif (watchers.length > 0) {\n\t\t\t\t\t\tthis.checkWatchers(watchers);\n\t\t\t\t\t}\n\n\t\t\t\t\t// if store attribute is set then store the values in local storage\n\t\t\t\t\tif (this.id && this.hasAttribute(\"store\")) {\n\t\t\t\t\t\tconst ls = localStorage.getItem(`action-form-${this.id}`) || \"{}\";\n\t\t\t\t\t\tif (ls && field.name) {\n\t\t\t\t\t\t\tconst values = JSON.parse(ls);\n\t\t\t\t\t\t\t// if element is a checkbox or radio than store as array of checked values\n\t\t\t\t\t\t\tif (field instanceof HTMLInputElement && [\"checkbox\", \"radio\"].includes(field.type)) {\n\t\t\t\t\t\t\t\t// create temporary array\n\t\t\t\t\t\t\t\tconst tempArray = values[field.name] instanceof Array ? values[field.name] : [];\n\t\t\t\t\t\t\t\t// update array based on checked value\n\t\t\t\t\t\t\t\tif (field.checked) {\n\t\t\t\t\t\t\t\t\ttempArray.push(field.value);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttempArray.splice(tempArray.indexOf(field.value), 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvalues[field.name] = tempArray;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalues[field.name] = field.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// if\n\t\t\t\t\t\t\tlocalStorage.setItem(`action-form-${this.id}`, JSON.stringify(values));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addEventListener(\"reset\", () => {\n\t\t\t\t// Remove store\n\t\t\t\tif (this.hasAttribute(\"store\")) {\n\t\t\t\t\tlocalStorage.removeItem(`action-form-${this.id}`);\n\t\t\t\t}\n\t\t\t\t// Find all invalid af-errors and hide them\n\t\t\t\tconst invalidErrors = form.querySelectorAll(\"af-error[invalid]\") as NodeListOf<ActionFormError>;\n\t\t\t\tinvalidErrors.forEach((error) => {\n\t\t\t\t\terror.showError(false);\n\t\t\t\t});\n\n\t\t\t\t// Move back to step 0\n\t\t\t\tthis.dispatchEvent(new CustomEvent(\"af-step\", { detail: { step: 0 } }));\n\t\t\t});\n\n\t\t\tthis.addEventListener(\"submit\", (e) => {\n\t\t\t\t// Validate form before submitting\n\t\t\t\tconst formValid = form.checkValidity();\n\t\t\t\tif (!formValid) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconsole.error(\"Form validation failed\");\n\t\t\t\t\t// find first invalid field or invalid af-group-count\n\t\t\t\t\tconst invalidField = form.querySelector(\"input:invalid, select:invalid, textarea:invalid, af-group-count[validity=false]\") as\n\t\t\t\t\t\t| FormField\n\t\t\t\t\t\t| ActionFormGroupCount\n\t\t\t\t\t\t| null;\n\t\t\t\t\tif (invalidField) {\n\t\t\t\t\t\tconst parentStep = invalidField.closest(\"af-step\") as null | ActionFormStep;\n\t\t\t\t\t\t// check if that field is a child of an af-step element\n\t\t\t\t\t\tif (parentStep) {\n\t\t\t\t\t\t\t// move to that step\n\t\t\t\t\t\t\tthis.dispatchEvent(new CustomEvent<ActionFormStepEvent>(\"af-step\", { detail: { step: Number(parentStep.dataset.index) } }));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconsole.log(\"invalidField\", invalidField);\n\t\t\t\t\t\tif (invalidField.matches(\"af-group-count\")) {\n\t\t\t\t\t\t\tconst otherField = invalidField.closest(\"fieldset\")?.querySelector(\"input, select, textarea\") as FormField | null;\n\t\t\t\t\t\t\totherField?.focus();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinvalidField.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinvalidField.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If form is valid then erase the stored values\n\t\t\t\t\tif (this.hasAttribute(\"store\")) {\n\t\t\t\t\t\tlocalStorage.removeItem(`action-form-${this.id}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate enhanceElements() {\n\t\t// find all elements with stored values and set value\n\t\tconst getStoreElements = this.querySelectorAll(\"[data-get-store]\") as NodeListOf<HTMLElement>;\n\t\tgetStoreElements.forEach((el) => {\n\t\t\tconst stored = el.dataset.getStore;\n\t\t\tif (!stored) return;\n\t\t\tif (isField(el)) {\n\t\t\t\t// split stored by periods\n\t\t\t\tconst parts = stored.split(\".\");\n\t\t\t\tconst ls = localStorage.getItem(parts[0]);\n\t\t\t\tif (ls) {\n\t\t\t\t\tif (parts.length > 1) {\n\t\t\t\t\t\tconst value = JSON.parse(ls)[parts[1]];\n\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\tel.value = String(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tel.value = ls;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// If store then update all fields (except type=\"hidden\") with stored values\n\t\tif (this.id && this.hasAttribute(\"store\")) {\n\t\t\tconst ls = localStorage.getItem(`action-form-${this.id}`);\n\t\t\tif (ls) {\n\t\t\t\tconst values = JSON.parse(ls);\n\t\t\t\tObject.keys(values).forEach((key) => {\n\t\t\t\t\tconst fields = this.querySelectorAll(`[name=\"${key}\"]`);\n\t\t\t\t\tfields.forEach((el) => {\n\t\t\t\t\t\tif (isField(el) && !el.matches(\"[type=hidden]\")) {\n\t\t\t\t\t\t\t// if this is a checkbox or radio button\n\t\t\t\t\t\t\tif (el instanceof HTMLInputElement && [\"checkbox\", \"radio\"].includes(el.type) && values[key] instanceof Array) {\n\t\t\t\t\t\t\t\t// set checked based on value in array\n\t\t\t\t\t\t\t\tel.checked = values[key].includes(el.value);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tel.value = String(values[key]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// find all watchers and create watcher array\n\t\tconst watchers = this.querySelectorAll(\"[data-if],[data-text]\") as NodeListOf<HTMLElement>;\n\n\t\twatchers.forEach((el) => {\n\t\t\tconst watch = el.dataset.if || el.dataset.text;\n\t\t\tconst value = el.dataset.ifValue;\n\t\t\tconst notValue = el.dataset.ifNotValue;\n\t\t\tconst regexStr = el.dataset.ifRegex;\n\t\t\t// if neither watch nor value is set, assume that any value is valid. RegExp /./ tests for any value\n\t\t\tconst regex: RegExp | undefined = regexStr ? new RegExp(regexStr) : undefined;\n\t\t\tif (watch) {\n\t\t\t\tthis.watchers.push({ name: watch, if: !!el.dataset.if, text: !!el.dataset.text, value, notValue, regex, el: el });\n\t\t\t}\n\t\t});\n\n\t\t// set Watchers from the start\n\t\tthis.checkWatchers();\n\t}\n\n\tpublic checkWatchers(watchers = this.watchers) {\n\t\t// Get FormData for watchers\n\t\tconst form = this.querySelector(\"form\");\n\t\tif (!form || watchers.length === 0) return;\n\t\tconst formData = new FormData(form);\n\t\t// Loop through watchers\n\t\twatchers.forEach((watcher) => {\n\t\t\tconst values = formData.getAll(watcher.name);\n\t\t\t// console.log(\"watchers values\", values, watcher);\n\n\t\t\t// Update textContent\n\t\t\tif (watcher.text) {\n\t\t\t\twatcher.el.textContent = values.join(\", \");\n\t\t\t}\n\n\t\t\t// Update display\n\t\t\tif (watcher.if) {\n\t\t\t\tlet valid = values.some((value) => {\n\t\t\t\t\t// typeof value === \"string\" is to ignore formData files\n\t\t\t\t\tif (typeof value === \"string\" && (watcher.value || watcher.regex)) {\n\t\t\t\t\t\t// if is is a string (rather than a File) there is a value or regex to check then check for that\n\t\t\t\t\t\treturn value === watcher.value || (watcher.regex && watcher.regex.test(value));\n\t\t\t\t\t}\n\t\t\t\t\t// if value has no value return false; otherwise true\n\t\t\t\t\treturn !!value;\n\t\t\t\t});\n\t\t\t\t// if valid and there is a notValue then check for that as well\n\t\t\t\tif (watcher.notValue && values.length !== 0 && valid) {\n\t\t\t\t\tvalid = values.every((value) => value !== watcher.notValue);\n\t\t\t\t}\n\t\t\t\t// console.log(\"watcher\", watcher.name, valid);\n\t\t\t\tthis.show(watcher.el, valid);\n\t\t\t\t// if this is af-step then trigger event to update progress bar since there is a change in the number of steps\n\t\t\t\tif (watcher.el.matches(\"af-step\")) this.dispatchEvent(new CustomEvent(\"af-step\"));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate show(el: HTMLElement, show: boolean): void {\n\t\tif (show) {\n\t\t\tel.style.display = \"\";\n\t\t\tel.removeAttribute(\"disabled\");\n\t\t} else {\n\t\t\tel.style.display = \"none\";\n\t\t\tel.setAttribute(\"disabled\", \"\");\n\t\t}\n\t\tel.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\t}\n\n\t// public connectedCallback(): void {\n\t// \tconsole.log(\"connected\");\n\t// }\n\n\t// public attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n\t// \tconsole.log(\"changed\", name, oldValue, newValue);\n\t// }\n}\ncustomElements.define(\"action-form\", ActionForm);\n"],"names":["isField","el","ActionForm","_a","__publicField","form","step","i","event","_b","_c","customEvent","stepIndex","shownIndex","field","id","errorById","errorByProximity","error","fieldset","groupCount","target","errorId","errorMsg","afError","valid","watchers","w","ls","values","tempArray","e","invalidField","parentStep","otherField","stored","parts","value","key","watch","notValue","regexStr","regex","formData","watcher","show"],"mappings":"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"}