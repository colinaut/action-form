{"version":3,"file":"af-step.js","sources":["../src/af-progress.ts","../src/af-step.ts"],"sourcesContent":["import type ActionForm from \"./action-form\";\nexport default class ActionFormProgress extends HTMLElement {\n\tprivate shadow: ShadowRoot;\n\tconstructor() {\n\t\tsuper();\n\t\tthis.shadow = this.attachShadow({ mode: \"open\" });\n\n\t\tif (!this.actionForm?.steps) return;\n\n\t\tthis.actionForm.addEventListener(\"af-step\", () => {\n\t\t\tthis.render();\n\t\t});\n\n\t\tthis.render();\n\n\t\tthis.shadow.addEventListener(\"click\", (e) => {\n\t\t\tconst target = e.target;\n\t\t\tif (target instanceof HTMLButtonElement && target.matches(\".step\") && !target.disabled) {\n\t\t\t\tconst step = Number(target.dataset.index || 0);\n\t\t\t\t// dispatch event to action-form which handles show/hide of steps\n\n\t\t\t\tthis.dispatchEvent(new CustomEvent(\"af-step\", { bubbles: true, composed: true, detail: { step } }));\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate actionForm = this.closest(\"action-form\") as ActionForm | null;\n\n\tget stepIndex(): number {\n\t\treturn this.actionForm?.stepIndex || 0;\n\t}\n\n\tprivate render() {\n\t\tif (!this.actionForm?.steps) return;\n\n\t\tconst stepsLength = Array.from(this.actionForm.steps).filter((step) => !(step.style.display === \"none\")).length;\n\t\tconst stepIndex = this.actionForm?.stepIndex || 0;\n\t\t// const stepIndex = this.actionForm?.stepIndex || 0;\n\n\t\tconst progressPercentage = (stepIndex / (stepsLength - 1)) * 100;\n\n\t\t// TODO: simplify this\n\t\tconst style = `\n        <style>\n        :host {\n            display: grid;\n            position: relative;\n            align-items: center;\n            --step-border-size: .22em;\n            --step-bg: white;\n            --step-text: inherit;\n            --inactive: lightgray;\n            --active: lightseagreen;\n            --invalid: coral;\n            --valid: var(--active);\n            --valid-bg: var(--active);\n            --valid-text: white;\n        }\n        .progress {\n            background: var(--active);\n            height: 0.5em;\n            grid-row: -1/1;\n            grid-column: -1/1;\n        }\n        nav {\n            margin: 0;\n            padding: 0;\n            list-style: none;\n            display: flex;\n            justify-content: space-between;\n            grid-row: -1/1;\n            grid-column: -1/1;\n        }\n        .bg {\n            background: var(--inactive);\n            height: 0.5em;\n            grid-row: -1/1;\n            grid-column: -1/1;\n        }\n        .step {\n            border: var(--step-border-size) solid var(--inactive);\n            border-radius: 100%;\n            width: 2em;\n            height: 2em;\n            line-height: 1.65em;\n            text-align: center;\n            background: var(--step-bg);\n            font-size: 0.9em;\n            position: relative;\n            z-index: 1;\n            padding: 0;\n            margin: 0;\n            cursor: pointer;\n            color: var(--step-text);\n        }\n        .valid:has(~ .active) {\n            border-color: var(--valid);\n            background: var(--valid-bg);\n            color: var(--valid-text);\n        }\n        .step:disabled {\n            opacity: 1;\n            cursor: not-allowed;\n        }\n        .active {\n            border-color: var(--active);\n        }\n        .step:not(.valid):has(~ .active) {\n            border-color: var(--invalid);\n        }\n        </style>\n        `;\n\n\t\t// TODO: add step titles from af-step\n\t\tthis.shadow.innerHTML = `${style}\n        <div class=\"bg\" part=\"bg\"></div>\n        <div class=\"progress\" part=\"progress\" style=\"width: ${progressPercentage}%;\"></div>\n        <nav part=\"nav\">\n        ${Array.from(this.actionForm?.steps)\n\t\t\t.filter((step) => !(step.style.display === \"none\"))\n\t\t\t.map((step, index) => {\n\t\t\t\tconst active = index === stepIndex ? \"active\" : \"\";\n\t\t\t\tconst valid = step.valid ? \"valid\" : \"\";\n\t\t\t\tconst disabled = this.hasAttribute(\"enable-all\") || stepIndex > index ? \"\" : \"disabled\";\n\t\t\t\tconst title = step.dataset.title || \"\";\n\t\t\t\treturn `<button type=\"button\" part=\"step ${valid} ${active}\" ${disabled} title=\"${title}\" class=\"step ${valid} ${active}\" ${\n\t\t\t\t\tactive && `aria-current=\"step\"`\n\t\t\t\t} aria-label=\"Step ${index + 1}\" data-index=\"${index}\">${index + 1}</button>`;\n\t\t\t})\n\t\t\t.join(\"\")}\n        </nav>\n        `;\n\t}\n}\ncustomElements.define(\"af-progress\", ActionFormProgress);\n","import type ActionForm from \"./action-form\";\nimport type ActionFormGroupCount from \"./af-group-count\";\nimport { ActionFormStepEvent } from \"./types\";\n\nexport default class ActionFormStep extends HTMLElement {\n\tprivate shadow: ShadowRoot | null;\n\t// this.this works if component uses Declarative Shadow DOM or not\n\t// TODO: test this with a browser that does not have Declarative Shadow DOM\n\tprivate this: this | ShadowRoot;\n\n\tprivate actionForm = this.closest(\"action-form\") as ActionForm | null;\n\n\t// Reflected Attributes\n\tget valid(): boolean {\n\t\treturn this.hasAttribute(\"valid\");\n\t}\n\n\tset valid(value: boolean) {\n\t\tif (value) {\n\t\t\tthis.setAttribute(\"valid\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"valid\");\n\t\t}\n\t}\n\n\t// Method Getter\n\tget isValid(): boolean {\n\t\t// console.log(\"isValid\", this.querySelectorAll(\":invalid\"));\n\t\tconst afGroupCount = this.querySelector(\"af-group-count\") as ActionFormGroupCount | null;\n\t\tlet valid = true;\n\t\tif (afGroupCount) {\n\t\t\tvalid = afGroupCount.validity;\n\t\t}\n\n\t\treturn valid && this.querySelectorAll(\":invalid\").length === 0;\n\t}\n\n\tprivate getStepTitle(direction: number = 1): string {\n\t\tif (this.actionForm) {\n\t\t\tlet otherStepIndex = Number(this.dataset.index || 0) + direction;\n\t\t\totherStepIndex = Math.max(0, Math.min(otherStepIndex, this.actionForm.steps.length - 1));\n\t\t\tconst otherStep = Array.from(this.actionForm.steps).find((step) => step.dataset.index === String(otherStepIndex));\n\t\t\treturn otherStep?.dataset.title || \"\";\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget prev() {\n\t\treturn this.getDataText(\"Prev\", -1);\n\t}\n\n\tget next() {\n\t\treturn this.getDataText(\"Next\", 1);\n\t}\n\n\tget submit() {\n\t\treturn this.getDataText(\"Submit\");\n\t}\n\n\tprivate getDataText(type: string, step?: number) {\n\t\tconst prop = `button${type}`;\n\t\treturn this.dataset[prop] || (step && this.getStepTitle(step)) || this.actionForm?.dataset[prop] || type;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst internals = this.attachInternals();\n\t\tthis.shadow = internals.shadowRoot;\n\t\tthis.this = this.shadow || this;\n\n\t\t// update validity and completed when change event is fired\n\t\tthis.this.addEventListener(\"change\", () => {\n\t\t\t// console.log(\"af-step change isValid\", event.target, this.isValid);\n\t\t\tthis.valid = this.isValid;\n\t\t});\n\n\t\t// trigger next or prev step\n\t\tthis.this.addEventListener(\"click\", (e) => {\n\t\t\tconst target = e.target;\n\t\t\tif (target instanceof HTMLButtonElement) {\n\t\t\t\tthis.step(Number(target.dataset.direction || 0));\n\t\t\t}\n\t\t});\n\n\t\tthis.actionForm?.addEventListener(\"af-step\", (event) => {\n\t\t\tif (!event.detail) {\n\t\t\t\tthis.setButtonTexts();\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic step(direction: number = 1) {\n\t\tif (direction === 0) return;\n\t\t// If button is next check if any elements are invalid before moving to next step\n\t\tif (direction > 0) {\n\t\t\tconst fields = this.querySelectorAll(\"input, select, textarea, af-group-count\") as NodeListOf<\n\t\t\t\tHTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | ActionFormGroupCount\n\t\t\t>;\n\n\t\t\tconst allValid = Array.from(fields).every((field) => {\n\t\t\t\tconst valid = field.checkValidity();\n\t\t\t\t// fire off change to trigger change listeners on action-form to update validity\n\t\t\t\tfield.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\t\t\t\t// console.log(\"ðŸš€ ~ FormStep ~ step ~ allValid ~ field:\", field, valid);\n\t\t\t\t// ends every loop on first invalid field\n\t\t\t\tif (!valid) {\n\t\t\t\t\tif (field.matches(\"af-group-count\")) {\n\t\t\t\t\t\tconst otherField = this.querySelector(\"input, select, textarea\") as HTMLElement | null;\n\t\t\t\t\t\totherField?.focus();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfield.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn valid;\n\t\t\t});\n\n\t\t\tif (!allValid) return;\n\t\t}\n\t\tthis.dispatchEvent(new CustomEvent<ActionFormStepEvent>(\"af-step\", { bubbles: true, detail: { direction } }));\n\t}\n\n\tpublic connectedCallback(): void {\n\t\t// console.log(\"connected\");\n\t\tthis.valid = this.isValid;\n\n\t\t// check for footer\n\t\tconst footer = this.this.querySelector(\"slot[name=footer]\") || this.this.querySelector(\"[slot=footer]\");\n\n\t\t// add footer if it doesn't exist\n\t\tif (!footer) {\n\t\t\tconst nav = document.createElement(\"nav\");\n\t\t\tnav.classList.add(\"af-step-nav\");\n\t\t\tnav.setAttribute(\"part\", \"step-nav\");\n\t\t\tnav.setAttribute(\"aria-label\", \"Step Navigation\");\n\t\t\tconst stepButton = (buttonText: string, next?: boolean) => {\n\t\t\t\treturn `<button type=\"button\" class=\"af-step-${next ? \"next\" : \"prev\"}\" data-direction=\"${next ? 1 : -1}\" part=\"step-btn ${\n\t\t\t\t\tnext ? \"next\" : \"prev\"\n\t\t\t\t}\">${buttonText}</button>`;\n\t\t\t};\n\t\t\tconst leftBtn = this.classList.contains(\"first\") ? `<span></span>` : stepButton(this.prev, false);\n\t\t\tconst rightBtn = this.classList.contains(\"last\") ? `<button type=\"submit\" part=\"submit\">${this.submit}</button>` : stepButton(this.next, true);\n\t\t\tnav.innerHTML = `${leftBtn}${rightBtn}`;\n\t\t\tthis.this.appendChild(nav);\n\t\t}\n\t}\n\n\tprivate setButtonTexts() {\n\t\tconst queryBtns = this.this.querySelectorAll(\"button[data-direction]\") as NodeListOf<HTMLButtonElement>;\n\t\tqueryBtns.forEach((btn) => {\n\t\t\tbtn.textContent = btn.dataset.direction === \"1\" ? this.next : this.prev;\n\t\t});\n\t}\n}\n\ncustomElements.define(\"af-step\", ActionFormStep);\n\n// Import af-progress so it is part of the af-step js bundle.\nimport \"./af-progress\";\n"],"names":["ActionFormProgress","_a","__publicField","target","step","_b","_c","stepsLength","stepIndex","progressPercentage","style","index","active","valid","disabled","title","ActionFormStep","internals","e","event","value","afGroupCount","direction","otherStepIndex","otherStep","type","prop","fields","field","otherField","nav","stepButton","buttonText","next","leftBtn","rightBtn","btn"],"mappings":"wKACA,MAAqBA,UAA2B,WAAY,CAE3D,aAAc,CAFf,IAAAC,EAGQ,QAFCC,EAAA,eAyBAA,EAAA,kBAAa,KAAK,QAAQ,aAAa,GAtB9C,KAAK,OAAS,KAAK,aAAa,CAAE,KAAM,OAAQ,GAE3CD,EAAA,KAAK,aAAL,MAAAA,EAAiB,QAEjB,KAAA,WAAW,iBAAiB,UAAW,IAAM,CACjD,KAAK,OAAO,CAAA,CACZ,EAED,KAAK,OAAO,EAEZ,KAAK,OAAO,iBAAiB,QAAU,GAAM,CAC5C,MAAME,EAAS,EAAE,OACb,GAAAA,aAAkB,mBAAqBA,EAAO,QAAQ,OAAO,GAAK,CAACA,EAAO,SAAU,CACvF,MAAMC,EAAO,OAAOD,EAAO,QAAQ,OAAS,CAAC,EAG7C,KAAK,cAAc,IAAI,YAAY,UAAW,CAAE,QAAS,GAAM,SAAU,GAAM,OAAQ,CAAE,KAAAC,CAAK,CAAA,CAAG,CAAC,EAClG,KAAK,OAAO,CACb,CAAA,CACA,EACF,CAIA,IAAI,WAAoB,CA5BzB,IAAAH,EA6BS,QAAAA,EAAA,KAAK,aAAL,YAAAA,EAAiB,YAAa,CACtC,CAEQ,QAAS,CAhClB,IAAAA,EAAAI,EAAAC,EAiCM,GAAA,GAACL,EAAA,KAAK,aAAL,MAAAA,EAAiB,OAAO,OAE7B,MAAMM,EAAc,MAAM,KAAK,KAAK,WAAW,KAAK,EAAE,OAAQH,GAAWA,EAAK,MAAM,UAAY,MAAO,EAAE,OACnGI,IAAYH,EAAA,KAAK,aAAL,YAAAA,EAAiB,YAAa,EAG1CI,EAAsBD,GAAaD,EAAc,GAAM,IAGvDG,EAAQ,mgCAwET,KAAA,OAAO,UAAY,GAAGA,CAAK;AAAA;AAAA,8DAE4BD,CAAkB;AAAA;AAAA,UAEtE,MAAM,MAAKH,EAAA,KAAK,aAAL,YAAAA,EAAiB,KAAK,EACvC,OAAQF,GAAWA,EAAK,MAAM,UAAY,MAAO,EACjD,IAAI,CAACA,EAAMO,IAAU,CACf,MAAAC,EAASD,IAAUH,EAAY,SAAW,GAC1CK,EAAQT,EAAK,MAAQ,QAAU,GAC/BU,EAAW,KAAK,aAAa,YAAY,GAAKN,EAAYG,EAAQ,GAAK,WACvEI,EAAQX,EAAK,QAAQ,OAAS,GAC7B,MAAA,oCAAoCS,CAAK,IAAID,CAAM,KAAKE,CAAQ,WAAWC,CAAK,iBAAiBF,CAAK,IAAID,CAAM,KACtHA,GAAU,qBACX,qBAAqBD,EAAQ,CAAC,iBAAiBA,CAAK,KAAKA,EAAQ,CAAC,WAAA,CAClE,EACA,KAAK,EAAE,CAAC;AAAA;AAAA,SAGX,CACD,CACA,eAAe,OAAO,cAAeX,CAAkB,ECnIvD,MAAqBgB,UAAuB,WAAY,CA4DvD,aAAc,CD/Df,IAAAf,ECgEQ,QA5DCC,EAAA,eAGAA,EAAA,aAEAA,EAAA,kBAAa,KAAK,QAAQ,aAAa,GAyDxC,MAAAe,EAAY,KAAK,kBACvB,KAAK,OAASA,EAAU,WACnB,KAAA,KAAO,KAAK,QAAU,KAGtB,KAAA,KAAK,iBAAiB,SAAU,IAAM,CAE1C,KAAK,MAAQ,KAAK,OAAA,CAClB,EAGD,KAAK,KAAK,iBAAiB,QAAUC,GAAM,CAC1C,MAAMf,EAASe,EAAE,OACbf,aAAkB,mBACrB,KAAK,KAAK,OAAOA,EAAO,QAAQ,WAAa,CAAC,CAAC,CAChD,CACA,GAEDF,EAAA,KAAK,aAAL,MAAAA,EAAiB,iBAAiB,UAAYkB,GAAU,CAClDA,EAAM,QACV,KAAK,eAAe,CACrB,EAEF,CA7EA,IAAI,OAAiB,CACb,OAAA,KAAK,aAAa,OAAO,CACjC,CAEA,IAAI,MAAMC,EAAgB,CACrBA,EACE,KAAA,aAAa,QAAS,EAAE,EAE7B,KAAK,gBAAgB,OAAO,CAE9B,CAGA,IAAI,SAAmB,CAEhB,MAAAC,EAAe,KAAK,cAAc,gBAAgB,EACxD,IAAIR,EAAQ,GACZ,OAAIQ,IACHR,EAAQQ,EAAa,UAGfR,GAAS,KAAK,iBAAiB,UAAU,EAAE,SAAW,CAC9D,CAEQ,aAAaS,EAAoB,EAAW,CACnD,GAAI,KAAK,WAAY,CACpB,IAAIC,EAAiB,OAAO,KAAK,QAAQ,OAAS,CAAC,EAAID,EACtCC,EAAA,KAAK,IAAI,EAAG,KAAK,IAAIA,EAAgB,KAAK,WAAW,MAAM,OAAS,CAAC,CAAC,EACvF,MAAMC,EAAY,MAAM,KAAK,KAAK,WAAW,KAAK,EAAE,KAAMpB,GAASA,EAAK,QAAQ,QAAU,OAAOmB,CAAc,CAAC,EACzG,OAAAC,GAAA,YAAAA,EAAW,QAAQ,QAAS,EACpC,CACO,MAAA,EACR,CAEA,IAAI,MAAO,CACH,OAAA,KAAK,YAAY,OAAQ,EAAE,CACnC,CAEA,IAAI,MAAO,CACH,OAAA,KAAK,YAAY,OAAQ,CAAC,CAClC,CAEA,IAAI,QAAS,CACL,OAAA,KAAK,YAAY,QAAQ,CACjC,CAEQ,YAAYC,EAAcrB,EAAe,CD1DlD,IAAAH,EC2DQ,MAAAyB,EAAO,SAASD,CAAI,GAC1B,OAAO,KAAK,QAAQC,CAAI,GAAMtB,GAAQ,KAAK,aAAaA,CAAI,KAAMH,EAAA,KAAK,aAAL,YAAAA,EAAiB,QAAQyB,KAASD,CACrG,CA8BO,KAAKH,EAAoB,EAAG,CAClC,GAAIA,IAAc,EAElB,IAAIA,EAAY,EAAG,CACZ,MAAAK,EAAS,KAAK,iBAAiB,yCAAyC,EAqB9E,GAAI,CAjBa,MAAM,KAAKA,CAAM,EAAE,MAAOC,GAAU,CAC9C,MAAAf,EAAQe,EAAM,gBAKpB,GAHMA,EAAA,cAAc,IAAI,MAAM,SAAU,CAAE,QAAS,EAAM,CAAA,CAAC,EAGtD,CAACf,EACA,GAAAe,EAAM,QAAQ,gBAAgB,EAAG,CAC9B,MAAAC,EAAa,KAAK,cAAc,yBAAyB,EAC/DA,GAAA,MAAAA,EAAY,OAAM,MAElBD,EAAM,MAAM,EAGP,OAAAf,CAAA,CACP,EAEc,MAChB,CACA,KAAK,cAAc,IAAI,YAAiC,UAAW,CAAE,QAAS,GAAM,OAAQ,CAAE,UAAAS,CAAY,CAAA,CAAC,CAAC,EAC7G,CAEO,mBAA0B,CAQhC,GANA,KAAK,MAAQ,KAAK,QAMd,EAHW,KAAK,KAAK,cAAc,mBAAmB,GAAK,KAAK,KAAK,cAAc,eAAe,GAGzF,CACN,MAAAQ,EAAM,SAAS,cAAc,KAAK,EACpCA,EAAA,UAAU,IAAI,aAAa,EAC3BA,EAAA,aAAa,OAAQ,UAAU,EAC/BA,EAAA,aAAa,aAAc,iBAAiB,EAC1C,MAAAC,EAAa,CAACC,EAAoBC,IAChC,wCAAwCA,EAAO,OAAS,MAAM,qBAAqBA,EAAO,EAAI,EAAE,oBACtGA,EAAO,OAAS,MACjB,KAAKD,CAAU,YAEVE,EAAU,KAAK,UAAU,SAAS,OAAO,EAAI,gBAAkBH,EAAW,KAAK,KAAM,EAAK,EAC1FI,EAAW,KAAK,UAAU,SAAS,MAAM,EAAI,uCAAuC,KAAK,MAAM,YAAcJ,EAAW,KAAK,KAAM,EAAI,EAC7ID,EAAI,UAAY,GAAGI,CAAO,GAAGC,CAAQ,GAChC,KAAA,KAAK,YAAYL,CAAG,CAC1B,CACD,CAEQ,gBAAiB,CACN,KAAK,KAAK,iBAAiB,wBAAwB,EAC3D,QAASM,GAAQ,CAC1BA,EAAI,YAAcA,EAAI,QAAQ,YAAc,IAAM,KAAK,KAAO,KAAK,IAAA,CACnE,CACF,CACD,CAEA,eAAe,OAAO,UAAWpB,CAAc"}