{"version":3,"file":"af-step.js","sources":["../src/af-step.ts"],"sourcesContent":["import type ActionForm from \"./action-form\";\nimport type ActionFormGroupCount from \"./af-group-count\";\n\nexport default class ActionFormStep extends HTMLElement {\n\tprivate shadow: ShadowRoot | null;\n\t// this.this works if component uses Declarative Shadow DOM or not\n\t// TODO: test this with a browser that does not have Declarative Shadow DOM\n\tprivate this: this | ShadowRoot;\n\n\t// properties grabbed from action-form\n\tprivate actionForm!: ActionForm;\n\tprivate numberOfSteps!: number;\n\n\t// Attributes\n\tget valid(): boolean {\n\t\treturn this.hasAttribute(\"valid\");\n\t}\n\n\tset valid(value: boolean) {\n\t\tif (value) {\n\t\t\tthis.setAttribute(\"valid\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"valid\");\n\t\t}\n\t}\n\n\tget active(): boolean {\n\t\treturn this.hasAttribute(\"active\");\n\t}\n\n\tset active(value: boolean) {\n\t\tif (value) {\n\t\t\tthis.setAttribute(\"active\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"active\");\n\t\t}\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst internals = this.attachInternals();\n\t\tthis.shadow = internals.shadowRoot;\n\t\tthis.this = this.shadow || this;\n\n\t\t// af-step requires action-form wrapper. Exit if it is not found\n\t\tconst actionForm = this.closest(\"action-form\") as ActionForm | null;\n\t\tif (!actionForm) return;\n\t\tthis.actionForm = actionForm;\n\t\tthis.numberOfSteps = actionForm.steps?.length || 0;\n\n\t\t// update validity and completed when change event is fired\n\t\tthis.this.addEventListener(\"change\", () => {\n\t\t\tconsole.log(\"af-step change isValid\", this.isValid);\n\t\t\tthis.valid = this.isValid;\n\t\t});\n\n\t\t// trigger next or prev step\n\t\tthis.this.addEventListener(\"click\", (e) => {\n\t\t\tconst target = e.target;\n\t\t\tif (!(target instanceof HTMLButtonElement)) return;\n\t\t\t// console.log(\"ðŸš€ ~ FormStep ~ this.addEventListener ~ target:\", target);\n\n\t\t\tif (target.matches(\".af-step-next\")) {\n\t\t\t\tthis.step(\"next\");\n\t\t\t} else if (target.matches(\".af-step-prev\")) {\n\t\t\t\tthis.step(\"prev\");\n\t\t\t}\n\t\t});\n\n\t\t//TODO: maybe change this to a mutation observer?\n\t\tthis.this.addEventListener(\"af-watcher\", () => {\n\t\t\tthis.valid = this.isValid;\n\t\t});\n\t}\n\n\tget isValid(): boolean {\n\t\t// console.log(\"isValid\", this.querySelectorAll(\":invalid\"));\n\t\tconst afGroupCount = this.querySelector(\"af-group-count\") as ActionFormGroupCount | null;\n\t\tlet valid = true;\n\t\tif (afGroupCount) {\n\t\t\tvalid = afGroupCount.validity;\n\t\t}\n\n\t\treturn valid && this.querySelectorAll(\":invalid\").length === 0;\n\t}\n\n\tget thisStep(): number {\n\t\treturn (\n\t\t\t(this.actionForm?.steps &&\n\t\t\t\tArray.from(this.actionForm.steps)\n\t\t\t\t\t.filter((step) => !step.hidden)\n\t\t\t\t\t.indexOf(this)) ||\n\t\t\t0\n\t\t);\n\t}\n\n\tget nextStep(): number | null {\n\t\treturn this.thisStep + 1 < this.numberOfSteps ? this.thisStep + 1 : null;\n\t}\n\tget prevStep(): number | null {\n\t\treturn this.thisStep - 1 >= 0 ? this.thisStep - 1 : null;\n\t}\n\n\tpublic step(direction: \"prev\" | \"next\" = \"next\") {\n\t\tconst directionIndex = direction === \"next\" ? this.nextStep : this.prevStep;\n\t\t// guard against negative step\n\t\tif (directionIndex === null) return;\n\n\t\t// console.log(\"ðŸš€ ~ FormStep ~ step ~ directionIndex:\", directionIndex);\n\n\t\t// If button is next check if any elements are invalid before moving to next step\n\t\tif (direction === \"next\") {\n\t\t\tconst fields = this.querySelectorAll(\"input, select, textarea, af-group-count\") as NodeListOf<\n\t\t\t\tHTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | ActionFormGroupCount\n\t\t\t>;\n\n\t\t\tconst allValid = Array.from(fields).every((field) => {\n\t\t\t\tconst valid = field.checkValidity();\n\t\t\t\t// fire off change to trigger change listeners on action-form to update validity\n\t\t\t\tfield.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\t\t\t\t// console.log(\"ðŸš€ ~ FormStep ~ step ~ allValid ~ field:\", field, valid);\n\t\t\t\t// ends every loop on first invalid field\n\t\t\t\tif (!valid) {\n\t\t\t\t\tif (field.matches(\"af-group-count\")) {\n\t\t\t\t\t\tconst otherField = this.querySelector(\"input, select, textarea\") as HTMLElement | null;\n\t\t\t\t\t\totherField?.focus();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfield.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn valid;\n\t\t\t});\n\n\t\t\tif (!allValid) return;\n\t\t}\n\n\t\tthis.active = false;\n\t\tthis.dispatchEvent(new CustomEvent(\"af-step\", { bubbles: true, detail: { step: directionIndex } }));\n\t}\n\n\tpublic connectedCallback(): void {\n\t\t// console.log(\"connected\");\n\t\tthis.valid = this.isValid;\n\n\t\t// check for footer\n\t\tconst footer = this.this.querySelector(\"slot[name=footer]\") || this.this.querySelector(\"[slot=footer]\");\n\n\t\t// add footer if it doesn't exist\n\t\tif (!footer) {\n\t\t\tconst nav = document.createElement(\"nav\");\n\t\t\tnav.classList.add(\"af-step-nav\");\n\t\t\tnav.setAttribute(\"part\", \"step-nav\");\n\t\t\tnav.setAttribute(\"aria-label\", \"Step Navigation\");\n\t\t\tconst stepButton = (direction: \"Next\" | \"Prev\") => {\n\t\t\t\treturn `<button type=\"button\" class=\"af-step-${direction.toLowerCase()}\" part=\"step-btn\">${direction}</button>`;\n\t\t\t};\n\t\t\tconst submit = `<button type=\"submit\" part=\"submit\">Submit</button>`;\n\t\t\tnav.innerHTML = `${this.prevStep !== null ? stepButton(\"Prev\") : `<span></span>`}\n            ${this.nextStep !== null ? stepButton(\"Next\") : submit}`;\n\t\t\tthis.this.appendChild(nav);\n\t\t}\n\t}\n}\n\ncustomElements.define(\"af-step\", ActionFormStep);\n"],"names":["ActionFormStep","_a","__publicField","internals","actionForm","e","target","value","afGroupCount","valid","step","direction","directionIndex","fields","field","otherField","nav","stepButton","submit"],"mappings":"wKAGA,MAAqBA,UAAuB,WAAY,CAmCvD,aAAc,CAnCf,IAAAC,EAoCQ,QAnCCC,EAAA,eAGAA,EAAA,aAGAA,EAAA,mBACAA,EAAA,sBA8BD,MAAAC,EAAY,KAAK,kBACvB,KAAK,OAASA,EAAU,WACnB,KAAA,KAAO,KAAK,QAAU,KAGrB,MAAAC,EAAa,KAAK,QAAQ,aAAa,EACxCA,IACL,KAAK,WAAaA,EACb,KAAA,gBAAgBH,EAAAG,EAAW,QAAX,YAAAH,EAAkB,SAAU,EAG5C,KAAA,KAAK,iBAAiB,SAAU,IAAM,CAClC,QAAA,IAAI,yBAA0B,KAAK,OAAO,EAClD,KAAK,MAAQ,KAAK,OAAA,CAClB,EAGD,KAAK,KAAK,iBAAiB,QAAUI,GAAM,CAC1C,MAAMC,EAASD,EAAE,OACXC,aAAkB,oBAGpBA,EAAO,QAAQ,eAAe,EACjC,KAAK,KAAK,MAAM,EACNA,EAAO,QAAQ,eAAe,GACxC,KAAK,KAAK,MAAM,EACjB,CACA,EAGI,KAAA,KAAK,iBAAiB,aAAc,IAAM,CAC9C,KAAK,MAAQ,KAAK,OAAA,CAClB,EACF,CA5DA,IAAI,OAAiB,CACb,OAAA,KAAK,aAAa,OAAO,CACjC,CAEA,IAAI,MAAMC,EAAgB,CACrBA,EACE,KAAA,aAAa,QAAS,EAAE,EAE7B,KAAK,gBAAgB,OAAO,CAE9B,CAEA,IAAI,QAAkB,CACd,OAAA,KAAK,aAAa,QAAQ,CAClC,CAEA,IAAI,OAAOA,EAAgB,CACtBA,EACE,KAAA,aAAa,SAAU,EAAE,EAE9B,KAAK,gBAAgB,QAAQ,CAE/B,CAwCA,IAAI,SAAmB,CAEhB,MAAAC,EAAe,KAAK,cAAc,gBAAgB,EACxD,IAAIC,EAAQ,GACZ,OAAID,IACHC,EAAQD,EAAa,UAGfC,GAAS,KAAK,iBAAiB,UAAU,EAAE,SAAW,CAC9D,CAEA,IAAI,UAAmB,CApFxB,IAAAR,EAqFE,QACEA,EAAA,KAAK,aAAL,YAAAA,EAAiB,QACjB,MAAM,KAAK,KAAK,WAAW,KAAK,EAC9B,OAAQS,GAAS,CAACA,EAAK,MAAM,EAC7B,QAAQ,IAAI,GACf,CAEF,CAEA,IAAI,UAA0B,CAC7B,OAAO,KAAK,SAAW,EAAI,KAAK,cAAgB,KAAK,SAAW,EAAI,IACrE,CACA,IAAI,UAA0B,CAC7B,OAAO,KAAK,SAAW,GAAK,EAAI,KAAK,SAAW,EAAI,IACrD,CAEO,KAAKC,EAA6B,OAAQ,CAChD,MAAMC,EAAiBD,IAAc,OAAS,KAAK,SAAW,KAAK,SAEnE,GAAIC,IAAmB,KAKvB,IAAID,IAAc,OAAQ,CACnB,MAAAE,EAAS,KAAK,iBAAiB,yCAAyC,EAqB9E,GAAI,CAjBa,MAAM,KAAKA,CAAM,EAAE,MAAOC,GAAU,CAC9C,MAAAL,EAAQK,EAAM,gBAKpB,GAHMA,EAAA,cAAc,IAAI,MAAM,SAAU,CAAE,QAAS,EAAM,CAAA,CAAC,EAGtD,CAACL,EACA,GAAAK,EAAM,QAAQ,gBAAgB,EAAG,CAC9B,MAAAC,EAAa,KAAK,cAAc,yBAAyB,EAC/DA,GAAA,MAAAA,EAAY,OAAM,MAElBD,EAAM,MAAM,EAGP,OAAAL,CAAA,CACP,EAEc,MAChB,CAEA,KAAK,OAAS,GACd,KAAK,cAAc,IAAI,YAAY,UAAW,CAAE,QAAS,GAAM,OAAQ,CAAE,KAAMG,CAAe,CAAA,CAAG,CAAC,EACnG,CAEO,mBAA0B,CAQhC,GANA,KAAK,MAAQ,KAAK,QAMd,EAHW,KAAK,KAAK,cAAc,mBAAmB,GAAK,KAAK,KAAK,cAAc,eAAe,GAGzF,CACN,MAAAI,EAAM,SAAS,cAAc,KAAK,EACpCA,EAAA,UAAU,IAAI,aAAa,EAC3BA,EAAA,aAAa,OAAQ,UAAU,EAC/BA,EAAA,aAAa,aAAc,iBAAiB,EAC1C,MAAAC,EAAcN,GACZ,wCAAwCA,EAAU,YAAa,CAAA,qBAAqBA,CAAS,YAE/FO,EAAS,sDACXF,EAAA,UAAY,GAAG,KAAK,WAAa,KAAOC,EAAW,MAAM,EAAI,eAAe;AAAA,cACrE,KAAK,WAAa,KAAOA,EAAW,MAAM,EAAIC,CAAM,GAC1D,KAAA,KAAK,YAAYF,CAAG,CAC1B,CACD,CACD,CAEA,eAAe,OAAO,UAAWhB,CAAc"}